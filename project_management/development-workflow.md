# 项目开发链路与里程碑
> 本文档旨在结合**项目分工**、**技术选型**与**定制化功能设计**，为“IP智慧解答专家系统”项目的所有成员提供一份统一、清晰、可执行的端到端开发指南与路线图。

## 第一阶段：需求分析、架构设计与环境准备
此阶段的核心目标是完成所有前期设计工作，并为后续的并行开发铺平道路，确保所有云服务和本地环境都配置妥当。

### 1.1 设计与规划任务

- [x] **市场与竞品分析**：研究现有的智能问答应用，明确本项目核心优势。
- [x] **产品与UI设计**：绘制系统主要界面的前端设计稿与UI稿，突出“智能问答”与“知识库管理”两大核心。
- [x] **技术架构设计**：完成项目技术选型、后端数据库结构设计，并由前后端共同定义出核心API接口文档。

### 1.2 技术实现：环境搭建与云服务配置
本节为将架构设计落地的详细步骤。

#### 1.2.1 本地基础设施搭建 (Docker)

为了方便开发和演示，我们将使用 Docker 启动项目所需的基础设施服务。请确保您已安装 Docker 和 Docker Compose。

1.  **创建 Docker Compose 文件**:
    在项目根目录下，定义项目所需的 `mysql` 和 `weaviate` 服务。

2.  **启动本地服务**:
    在终端中，进入项目根目录，运行类似如下命令：
    ```bash
    docker-compose -f docker-compose.local.yml up -d
    ```
    该命令将在后台启动并运行 MySQL 和 Weaviate 容器。

    - **MySQL**: 关系型数据库，监听本地 `3306` 端口。用于存储用户信息、案例元数据等。
    - **Weaviate**: 向量数据库，监听本地 `8080` (REST) 和 `50051` (gRPC) 端口。用于存储文档向量以供检索。

#### 1.2.2 云端 AI 服务配置
本项目保留了部分核心AI能力在云端，以确保高质量的演示效果。

##### 步骤一：开通大模型与文档智能服务
1.  **百炼大模型服务 (LLM)**:
    - 访问[百炼大模型平台控制台](https://bailian.console.aliyun.com/)。
    - 在 **API Key 管理** 页面创建并保管好您的 `API Key`。后端将使用此 Key 调用 `qwen-plus` 等模型。
2.  **文档智能 (Document Mind)**:
    - 访问阿里云控制台，开通“文档智能”服务。
    - 通常新用户会有免费额度。您需要获取调用该服务所需的 AccessKey 信息。

#### 1.2.3 本地后端与前端环境
- **后端 (Flask)**:
    - 在虚拟环境中安装 `requirements.txt` 中的所有依赖（包括云服务SDK）。
    - 配置环境变量：`DASHSCOPE_API_KEY`、`ALIBABA_ACCESS_KEY_ID`、`ALIBABA_ACCESS_KEY_SECRET`。
    - 修改配置文件，将数据库、向量数据库的连接地址指向本地 Docker 服务。
    - 运行 `flask run` 启动本地开发服务器。
- **前端 (Vue)**:
    - 使用 `yarn` 安装 `package.json` 中的依赖。
    - 运行 `yarn dev` 启动前端开发服务器。

## 第二阶段：并行开发

此阶段是项目的主体，各团队根据职责划分，并行开发核心功能模块。此阶段预期持续约**1.5个月**。

### A. 前端开发团队 (2人)
- **核心目标**: 根据设计稿完成用户界面、问答交互、数据可视化看板的开发。
- **具体实施**:
    - [ ] **任务1：项目初始化与布局**
        - **步骤**:
            - 使用 `yarn` 初始化 `Vue3 + TypeScript` 项目。
            - 引入 **Ant Design Vue** UI库。
            - 搭建UI/UX蓝图中定义的**三栏式布局**。

    - [ ] **任务2：认证与案例管理**
        - **步骤**:
            - 开发登录 `Modal`，调用 `/auth/login` 接口，并将JWT存储在本地。
            - 封装 `fetch` 请求，统一处理`Authorization`头部。
            - 调用 `GET /cases` 获取并展示诊断历史列表。

    - [ ] **任务3：可视化诊断图**
        - **步骤**:
            - 在主画布区域，使用**SVG**或图表库（如`d3.js`, `G6`）渲染后端返回的节点和边。
            - 实现节点的拖拽、缩放、点击交互。

    - [ ] **任务4：核心交互界面**
        - **步骤**:
            - **右侧详情面板**：根据节点类型，动态展示节点详情、知识溯源或可复制命令。
            - **Agent追问**：当节点状态为`AWAITING_USER_INPUT`时，渲染输入框，调用`/interactions`接口。
            - **知识溯源**：渲染可点击的引用标签`[doc1]`，并高亮展示原文片段。

    - [ ] **任务5：数据看板与设置**
        - **步骤**: 开发“数据看板”和“系统设置”页面。

    - [ ] **任务6：知识管理页面 & 上传功能**
        - **步骤**:
            - 在侧边栏新增“知识库”入口，打开后展示用户已上传文档列表（调用 `GET /knowledge/documents`）。
            - 实现文档上传 `Modal`，支持拖拽或文件选择，提交 `POST /knowledge/documents`。
            - 在列表中展示解析进度；支持删除（调用 `DELETE /knowledge/documents/{docId}`）。

### B. 后端开发与AI模型团队 (5人)
- **核心目标**: 实现服务架构、混合检索算法、知识库管理、AI模型集成等核心功能。
- **团队构成**: 原后端团队3人 + 原模型团队2人
- **具体实施**:
    - [ ] **任务1：Flask项目搭建与认证**
        - **步骤**:
            - 初始化Flask项目，使用 **SQLAlchemy** 定义数据库模型。
            - 实现 `/auth/login` 接口，使用 **JWT** 生成Token。

    - [ ] **任务2：高级知识处理流水线**
        - **步骤**:
            - 编写**后台异步任务**，用于轮询数据库中的 `parsing_jobs` 表。
            - **集成IDP服务**：调用**文档智能（Document Mind）API**取代传统解析库，对上传的文档进行细粒度解析和版面分析。
            - **实现语义切分**：基于IDP返回的结构化数据（如层级树），实现语义感知的文本切分。
            - **向量化与入库**：调用阿里云百炼平台的text-embedding-v4模型API向量化，并将结构化文本块及元数据写入本地的 **Weaviate** 向量数据库。

    - [ ] **任务3：混合检索API核心**
        - **步骤**:
            - 实现**两阶段检索**：首先通过向量+关键词召回候选文档，然后调用**Qwen3-Reranker**模型进行精准排序。
            - 最终选取精排后的Top-K结果作为LLM的上下文。

    - [ ] **任务4：Agentic多轮对话框架**
        - **步骤**:
            - 使用 **`langgraph`** 构建状态机管理诊断流程。
            - 实现“分析查询”、“RAG检索”、“追问用户”等节点，实现主动追问。

    - [ ] **任务5：核心业务API实现**
        - **步骤**: 实现 `POST /cases`、`POST /cases/{caseId}/interactions`、`POST /cases/{caseId}/feedback` 等核心接口。

    - [ ] **任务6：数据看板API实现**
        - **步骤**: 实现 `GET /statistics` 接口，负责从数据库中聚合生成看板所需的统计数据。
        - **关键技术栈**: `SQLAlchemy` (用于数据聚合查询)

    - [ ] **任务7：知识文档API实现**
        - **步骤**:
            - 创建 `POST /knowledge/documents` 端点，接收多部分文件并存储至**本地文件系统**；写入 `knowledge_document` 表保存元数据。
            - 创建 `GET /knowledge/documents`、`GET /knowledge/documents/{docId}`、`DELETE /knowledge/documents/{docId}` 接口。
            - **新增** `PUT /knowledge/documents/{docId}/reparse`：支持失败后重试，重新投递解析任务。
            - 上传成功后，在 **`parsing_jobs` 表中插入一条新记录**，由后台异步任务负责消费，并最终回写状态到`knowledge_document`表。

### C. 团队协作说明

**注意**: 原后端团队(3人)和模型团队(2人)已合并为统一的后端开发与AI模型团队(5人)。

#### 分工协作:
- **后端团队成员**: 主要负责Flask架构、API开发、数据库设计、异步任务系统
- **模型团队成员**: 主要负责AI服务开发、向量数据库、检索算法、Agent流程
- **共同协作**: `app/services/` 目录下的AI服务模块集成、系统测试

详细的任务分工和实施指南请参考：**[后端开发与AI模型团队任务指南](./backend-team-guide.md)**

<br>

## 第三阶段：联调测试与交付

此阶段的目标是整合所有功能，进行端到端测试，并完成所有交付材料的准备工作。

- [ ] **集成联调**：完成前后端整体功能联调与端到端测试。
- [ ] **交付材料准备**：录制并剪辑最终的参赛演示视频，完成技术白皮书的撰写。
- [ ] **部署与演示**：完成项目部署，准备最终答辩。

- [ ] **任务1：端到端联调 (全体开发)**
    - **步骤**:
        - 前端完整接入所有后端API，确保数据流和交互逻辑正确无误。
        - 重点测试**创建诊断 -> Agent追问 -> 用户补充 -> 生成方案 -> 提交反馈**的全流程。
        - **新增测试**：**上传知识文档 → 后台任务处理 → 文档状态变为 `INDEXED` → 在问题检索中命中该文档片段**。

- [ ] **任务2：交付材料准备 (演示与文档负责人)**
    - **步骤**:
        - **技术白皮书**：综合所有设计文档和开发实践，撰写最终的技术白皮书。
        - **演示视频**：设计演示脚本，录制并剪辑一个能完整展示项目亮点的视频。

- [ ] **任务3：部署与预演 (全体开发)**
    - **步骤**:
        - 将后端应用和前端构建产物打包。
        - 在演示电脑上运行后端服务和前端服务。